---
title: "Lab1"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

First, we load the data into R.  We do this using dplyr to take advantage of its table manipulation methods.  For easy access, we join the three datasets together.  A simple full_join is sufficient.


```{r load_data, warning=FALSE}
library(dplyr)
t1 = as_tibble(read.csv('Penetration.csv', stringsAsFactors = F))
t2 = as_tibble(read.csv('Price.csv', stringsAsFactors = F))
t3 = as_tibble(read.csv('Speed.csv', stringsAsFactors = F))

t = t1 %>% full_join(t2) %>% full_join(t3)
str(t)
```

We see a couple of issues with the data:
1. There are two blank rows at the bottom, which We filter out of the table.  
2. The 'X' variable seems to be empty, so we omit that column.
3. Due to a typo in the original data, Both 'Country.Code' and 'Country.code' exist.  We omit the latter.
4. There are percent signs, dollar signs, and commas being used as decimal separators.  There's probably some R function better than read.csv for cleaning these columns, but let's use some regular expressions just for fun. 

```{r clean_data, warning=FALSE}
clean_percent = function(x) as.numeric(gsub('%', '', x))
clean_dollar = function(x) as.numeric(gsub('\\$', '', x))
clean_commas = function(x) as.numeric(gsub(',', '.', x))

t = t %>%
    filter(Country != '') %>%
    select(-c(X, Country.code)) %>%
    mutate(Growth.in.3G.penetration = clean_percent(Growth.in.3G.penetration)) %>%
    mutate(Percent.of.population.in.urban.areas = clean_percent(Percent.of.population.in.urban.areas))

for (c in grep('Price', names(t))) t[c] = unlist(lapply(t[c], clean_dollar))
for (c in grep('Maximum|Average|Standard|Median|X90p', names(t))) t[c] = unlist(lapply(t[c], clean_commas))
str(t)
```

Now we have a tidy data set.  All the columns hold either numeric or integer data with the exceptions of 'Country' and 'Country.Code', which we'll leave as character vectors for now.

## Exploratory Data Analysis

Create the scatterplot matrix to investigate the relationships between variables. We focus on the Household Penetration Rate, Average Actual Speed, and the Price for high, medium, and low speed.

```{r}
library(car)

scatterplotMatrix( ~ t$Household.penetration..OECD  + t$Average.actual.speed..Akamai..kbps. + t$Price.for.high.speeds..combined + Price.for.very.high.speeds..combined, 
                   data = t,
                   main = "Scatterplot Matrix for Penetration, Actual Speed, and Price for Very High and High Speed")


scatterplotMatrix( ~ t$Household.penetration..OECD  + t$Average.actual.speed..Akamai..kbps. + t$Price.for.med.speeds..combined,
                   data = t,
                   main = "Scatterplot Matrix for Penetration, Actual Speed, and Price for Medium Speed")

scatterplotMatrix( ~ t$Household.penetration..OECD+ t$Average.actual.speed..Akamai..kbps. + t$Price.for.low.speeds..combined, 
                   data = t,
                   main = "Scatterplot Matrix for Penetration, Actual Speed, and Price for Low Speed")

```

From the scatter plot matrix we discovered:
1. There is a positive relationship between the household penetration rate and the actual speed, only when the consumers are paying for high or very high speed. 
2. House penetration rate and the medium and low price displayed negative relationship. The result suggested that the lower the price consumer paid, the less house penetration rate the signal is.



Get the descriptive statistics of the variables

```{r}
summary(t$Household.penetration..OECD)
```

```{r}
summary(t$Average.actual.speed..Akamai..kbps.)
```

```{r}
summary(t$Price.for.very.high.speeds..combined)
```

Create the histogram for very high speed price

```{r}
hist(t$Price.for.very.high.speeds..combined, main = "Price for high speed",
     xlab = NULL)
axis(2, at = 0:135)
```

Create the regression line to see the relationship.
```{r}
plot(t$Household.penetration..OECD, factor = 2, t$Price.for.very.high.speeds..combined, factor = 2,
     xlab = "House Penetration", ylab = "Very High Speed Price",
     main = "House Penetration and Price of Very High Speed")
abline(lm(t$Household.penetration..OECD ~ t$Price.for.very.high.speeds..combined))
```


```{r}
summary(t$Price.for.high.speeds..combined)

summary(t$Price.for.med.speeds..combined)

summary(t$Price.for.low.speeds..combined)
```